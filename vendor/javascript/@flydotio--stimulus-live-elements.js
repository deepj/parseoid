import{Controller as e}from"@hotwired/stimulus";class live_elements_controller extends e{connect(){this.token=document.querySelector('meta[name="csrf-token"]').content;this.queue=Promise.resolve();this.monitor(this.element);this.observer=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{e.nodeType==Node.ELEMENT_NODE&&this.monitor(e)}))}))}));this.observer.observe(this.element,{subtree:true,childList:true})}disconnect(){this.observer.disconnect()}monitor(e){for(let t of e.querySelectorAll("*[data-action]"))for(let[e,o]of Object.entries(JSON.parse(t.dataset.action)))t.addEventListener(e,(e=>{e.preventDefault();this.queue=this.queue.then((()=>new Promise(((r,n)=>{this.execute(t,o,e,r)}))))}))}execute(e,t,o,r){let n="post";let s;let a=null;if(e.form){n=e.form.method;s=new FormData(e.form)}else s=new FormData;"BUTTON"==e.nodeName&&s.append(e.name,e.textContent);if("get"==n.toLowerCase()){t=new URL(t,window.location);for(let[e,o]of s.entries())t.searchParams.append(e,o)}else a=new URLSearchParams(s).toString();fetch(t,{method:n,headers:{"X-CSRF-Token":this.token,Accept:"text/vnd.turbo-stream.html","Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:a}).then((e=>e.text())).then((e=>Turbo.renderStreamMessage(e))).finally((()=>window.requestIdleCallback?window.requestIdleCallback(r,{timeout:100}):setTimeout(r,50)))}catch(e){console.error(e);resolve()}}export{live_elements_controller as default};

